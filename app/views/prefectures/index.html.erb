<div class="container">
  <div class="d-md-flex flex-row justify-content-center text-center">
    <div class="col-md-8">
      <h2 class="top-rank-prefecture">魅力ランキング</h2>
      <table class="table table-top table-rank-prefecture table-bordered text-nowrap">
        <thead>
          <tr>
            <th>順位</th>
            <th>都道府県</th>
            <th>魅力</th>
          </tr>
        </thead>
        <tbody>
          <!--順位を出すための比較対象を一時的に保存するため-->
          <% last_prefecture_charms = 0 %>
          <!--ランキングのスタート順位-->
          <% rank = 1 %>
          <% @prefecture_ranks.each.with_index(1) do |prefecture, i| %>
            <tr>
              <td>
          		  <!--もし、対象のカウントが同位置ならそのまま表示-->
                <% if prefecture.count == last_prefecture_charms %>
            		  第<%= rank %>位
            		<% else %>
            			<!--異なる場合は、rankに現在のループ回数を入れる-->
            			<% rank = i %>
            			第<%= rank %>位
            		<% end %>
            	  <!--仮のお気に入り数を一時的保存-->
              	<% last_prefecture_charms = prefecture.count %>
              </td>
              <td><%= link_to prefecture.prefecture, posts_search_path(prefecture_id: prefecture.id) %></td>
              <td><%= prefecture.count %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
